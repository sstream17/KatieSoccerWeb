@page "/play"
@page "/play/{id}"
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject HttpClient Http
@inject NavigationManager NavigationManager

<GameContainer Id="@Id" />

@code {
    [Parameter]
    public string Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (Id == null)
        {
            Id = Guid.NewGuid().ToString();
        }

        await localStorage.SetItemAsync(LocalStorageKeyConstants.GameIdKey, Id);

        var name = await localStorage.GetItemAsync<string>(LocalStorageKeyConstants.NameKey);
        var color = await localStorage.GetItemAsync<string>(LocalStorageKeyConstants.ColorKey);

        var player = new Player
        {
            Name = name,
            Color = color,
            IsLocal = true
        };

        var response = await Http.PutAsJsonAsync(NavigationManager.ToAbsoluteUri($"/game/{Id}"), player);
    }
}